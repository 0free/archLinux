
pkgname=pamac
pkgver=11.3.1
pkgrel=1
pkgdesc="Graphical Package Manager for Manjaro Linux with Alpm, AUR, Appstream, Flatpak and Snap support"
arch=('x86_64')
url="https://gitlab.manjaro.org/applications/pamac"
license=('GPL3')
depends=('libnotify' 'libpamac' 'libhandy')
optdepends=('polkit-gnome: needed for authentification in Cinnamon, Gnome'
            'lxsession: needed for authentification in Xfce, LXDE etc.')
makedepends=('gettext' 'itstool' 'vala' 'meson' 'ninja' 'gobject-introspection' 'xorgproto' 'asciidoc' 'git')
options=(!emptydirs !strip)
provides=('pamac=$pkgver-$pkgrel')
conflicts=('pamac-all' 'pamac-all-git' 'pamac-aur' 'pamac-aur-git')
source=(git+https://gitlab.manjaro.org/applications/$pkgname.git)
sha256sums=('SKIP')

pkgver() {

  cd $pkgname
  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g' | cut -c2-48

}

prepare() {

  cd $pkgname
  sed -i -e "s|\"$_pkgver\"|\"$pkgver-$pkgrel\"|g" src/manager_window.vala

}

build() {

  cd $pkgname
  mkdir -p builddir
  cd builddir
  meson --prefix=/usr --sysconfdir=/etc --buildtype=release -Denable-fake-gnome-software=true
  ninja

}

package() {

  conflicts=('pamac-aur')
  install=pamac.install
  cd $pkgname
  cd builddir
  DESTDIR="$pkgdir" ninja install
  rm "$pkgdir/usr/bin/gnome-software"
  rm "$pkgdir/usr/share/applications/org.gnome.Software.desktop"
  rm "$pkgdir/usr/share/dbus-1/services/org.gnome.Software.service"

}
